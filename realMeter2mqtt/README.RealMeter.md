# Setup for Real Meter

When working with real meter, need to the following:

- IP address of smart meter
- SSL certificates (LFDIs)

Follow step by step guide below:

#### step-1: Generate SSL Certificates

Generate an SSL key to use to provide a handshake to your meter. Add this to your Xcel launchpad by clicking "Add a Device" and paste in the LFDI generated by the script below. Nickname, Manufacturer of Device, and Device Type can be whatever you want.

```bash
./scripts/generate_keys.sh
```

This script will generate new keys and print out the LFDI string to use for registering with Xcel. If you're already generated keys and you need to retrieve the LFDI string again run:

```bash
./scripts/generate_keys.sh -p
```

These keys will be saved in the local directory `certs/.cert.pem` and `certs/.key.pem`

#### step-2: Configure environment

- run `setup_env.sh` script

  ```
  ./mqtt2grafana/scripts/setup_env.sh
  ```

  > creates .env file inside mqtt2grafana dir

#### Step-2: Setup data source `simulator2mqtt`

- `simulator2mqtt` sends get request to meterSimulatorAgent in Energy Launchpad and publishes the response to MQTT topic. To make this work:
- clone energy launchpad repo, cd to the repo and run `docker compose up`
- Install python dependencies found in `Pipfile` and then,
- run `main_simulated_pub.py`.

#### Step-3: InfluxDB

- Login into InfluxDB dashboard at http://localhost:8086
- create an API token to link InfluxDB with Grafana. (Follow instruction [here](/mqtt2grafana/docs/api_token.md))

  > use `DataExplorer` feature in InfluxDB UI, to confirm data is coming into InfluxDB
  > use `query Builder` feature in InfluxDB and use the query to build a dashborad in grafana.

  > **Note**: login username & passwords are in `.env`.

#### Step-4: Grafana

- Login into Grafana dashboard at http://localhost:8086
- connect grafana with InfluxDB follow [instructions](/mqtt2grafana/docs/connect_influxdb_2_grafana.md)
- create visualization & customize it.
